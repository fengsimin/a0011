<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\141\x2f\146\x69\156\144\145\162\57"; function __construct() { goto MzQVz; MzQVz: if ($this->table) { goto V56QM; } goto sAt4t; svdlF: parent::__construct(); goto rjiEd; sAt4t: $this->table = "\x66\151\156\144\145\162"; goto ayi5u; ayi5u: V56QM: goto svdlF; rjiEd: } protected function postAll($pid, $request_data) { goto xlxny; PyFVA: $level = $this->db->select($this->table, "\154\x65\166\x65\154")->where(array("\151\144", "\x3d", $pid))->get(0); goto SJl9T; sK3Z1: return array("\x66\151\x6c\145\163" => $files, "\x70\x61\x74\150\163" => $paths); goto k8g03; SJl9T: $level = array_filter(explode("\54", $level)); goto QmDgw; RhtQD: if (!$pid) { goto NVV0R; } goto PyFVA; XsoZ3: NVV0R: goto sK3Z1; xlxny: $files = $this->db->select($this->table)->where($request_data["\167\150\x65\162\x65"])->order($request_data["\x6f\x72\144\145\x72"])->all(); goto vQJlw; vQJlw: $paths = array(); goto RhtQD; QmDgw: $paths = $this->db->select($this->table, array("\151\144", "\x6e\141\155\x65"))->where(array("\x69\144", "\x49\x4e", $level), "\101\116\x44", array("\x74\171\160\145", "\x3d", "\146\x6f\x6c\144\145\x72"))->all(); goto XsoZ3; k8g03: } protected function postAdd($request_data) { goto dAkiN; evnxT: if (!$this->db->update($this->table, array("\x6c\x65\x76\x65\x6c" => $level), array("\151\144", "\x3d", $id))->is()) { goto NFnt1; } goto Prui4; Prui4: $this->db->commit(); goto NU_Bc; CAG1C: if (mkdir($this->_UTF82GBK("\56\x2e\x2f" . $path), 511, true)) { goto NSQDw; } goto CSX_f; JMrHy: $this->db->rollBack(); goto lxtiQ; b6kAk: $data["\x77\x69\144\x74\150"] = $imagesize[0]; goto GOtWH; Dul1k: WJPLH: goto PjOR2; C74Qe: $data["\160\141\x74\150"] = $path; goto gSr60; xILit: $data["\145\170\164"] = end(explode("\56", $name)); goto hjR4V; CSX_f: return $this->error("\345\210\233\xe5\273\xba\xe6\226\207\xe4\xbb\xb6\xe5\xa4\xb9\345\xa4\xb1\xe8\264\xa5\xef\274\201"); goto M42VK; djxmf: TeRYW: goto C74Qe; y4C1J: if (!(stripos($type, "\151\x6d\141\147\145") !== false && is_file($filename))) { goto TeRYW; } goto uNIqp; i_lC3: if (is_dir($this->_UTF82GBK("\x2e\x2e\57" . $path))) { goto gZks3; } goto CAG1C; GOtWH: $data["\x68\145\x69\147\x68\164"] = $imagesize[1]; goto djxmf; FKQk8: $this->db->rollBack(); goto YY7ZI; dAkiN: $path = $request_data["\x70\x61\164\150"]; goto OUpBM; WInDj: gZks3: goto uDauB; gSr60: $data["\x6e\x61\155\145"] = $name; goto rKtxg; PjOR2: $level = $this->_getLevel($id); goto evnxT; gmGFc: $data["\x73\151\172\x65"] = $request_data["\x73\x69\x7a\x65"]; goto hEriY; uNIqp: $imagesize = getimagesize($filename); goto b6kAk; NU_Bc: return $this->success(); goto S6_6x; hjR4V: $this->db->beginTransaction(); goto JJI0E; uDauB: $filename = $this->_UTF82GBK("\56\56\57" . $path . $name); goto y4C1J; TQoZ6: $type = mime_content_type("\x2e\x2e\57" . $path . $name); goto B048G; lxtiQ: return $this->error("\344\xb8\212\344\xbc\240\xe6\226\207\344\xbb\266\40" . $name . "\x20\xe5\244\261\350\xb4\xa5\xef\xbc\x81"); goto Dul1k; YY7ZI: return $this->error("\xe4\xb8\x8a\344\xbc\xa0\xe6\x96\x87\xe4\273\xb6\40" . $name . "\40\345\244\261\350\xb4\245\357\xbc\201"); goto xKwkb; JJI0E: if ($id = $this->db->insert($this->table, $data)->id()) { goto WJPLH; } goto gGXbv; OUpBM: $name = $request_data["\x6e\x61\155\145"]; goto TQoZ6; hEriY: $data["\x63\164\151\155\x65"] = time(); goto xILit; PBAcC: $data["\160\x69\144"] = $foid ? $foid : 0; goto gmGFc; M42VK: NSQDw: goto WInDj; S6_6x: NFnt1: goto FKQk8; rKtxg: $data["\x74\x79\160\145"] = $type; goto PBAcC; B048G: $foid = $request_data["\x66\157\x69\144"]; goto i_lC3; gGXbv: unlink($filename); goto JMrHy; xKwkb: } protected function postMkdir($request_data) { goto ukVFU; Cri5g: if ($this->db->update($this->table, array("\154\x65\x76\x65\x6c" => $level), array("\151\144", "\75", $id))->is()) { goto UYNgN; } goto Lt1mI; Hb1qO: if (mkdir($dirname, 493, true)) { goto U3yl5; } goto YacXV; YacXV: return $this->error("\345\x88\233\345\xbb\272\xe6\226\207\344\273\xb6\xe5\244\xb9\345\244\xb1\350\xb4\245\357\274\201"); goto n0VHa; zU4NF: $this->db->commit(); goto MKLxM; CzbZB: $name = $request_data["\156\141\x6d\145"]; goto nmMcl; m0UrP: foreach ($folder as $value) { $folder_path .= $value["\156\141\x6d\x65"] . "\x2f"; hl5Ba: } goto qHnLx; OYVty: tB0Uy: goto cxTNc; XBtDb: return $this->error("\xe6\227\240\346\x95\x88\xe7\x9a\x84\345\x8f\202\xe6\225\260\357\274\201"); goto kSwbw; P1ARm: $folder_path = ''; goto qOF3n; z4zLI: $data["\x6e\141\x6d\x65"] = $name; goto mTcch; Wggzz: $this->db->beginTransaction(); goto oaQC2; leslh: if ($id = $this->db->insert($this->table, $data)->id()) { goto b2xHl; } goto hFajL; MKLxM: return $this->success(); goto bw9Dj; qHnLx: dWiMd: goto OYVty; b9GbI: goto qafEd; goto n4uba; cxTNc: $dirname = $this->_UTF82GBK("\x2e\56\x2f" . $this->root . $folder_path . $name); goto k8j1t; AxXjY: return $this->error($name . "\x20\346\226\x87\xe4\xbb\266\345\244\271\xe5\267\xb2\345\255\230\345\234\xa8\357\xbc\x81"); goto XQiDa; hFajL: rmdir($dirname); goto z7Shv; mTcch: $data["\x70\151\144"] = $pid; goto P1ARm; n0VHa: U3yl5: goto Wggzz; Lt1mI: rmdir($dirname); goto Q6za5; nG_4b: $data["\143\x74\151\x6d\x65"] = time(); goto leslh; n4uba: UYNgN: goto zU4NF; ukVFU: $pid = $request_data["\160\151\144"]; goto CzbZB; z7Shv: $this->db->rollBack(); goto wlMbd; qOF3n: $level = $this->db->select($this->table, "\140\154\145\166\145\x6c\x60")->where(array("\x69\x64", "\75", $pid))->get(0); goto q2V2Z; W4Iqg: $data["\x74\171\x70\145"] = "\x66\x6f\154\x64\145\162"; goto nG_4b; oaQC2: $data["\x70\x61\164\x68"] = $this->root . $folder_path; goto ZOv0S; q2V2Z: if (!$level) { goto tB0Uy; } goto x1H9w; wlMbd: return $this->error("\345\210\233\xe5\xbb\xba\xe6\x96\x87\344\xbb\266\xe5\244\271\xe5\xa4\xb1\350\xb4\245\357\274\x81"); goto CW_Xp; kSwbw: oPLpC: goto Vbsu4; ZOv0S: $data["\163\157\162\164\142\171"] = 1; goto W4Iqg; CW_Xp: b2xHl: goto AyngC; k8j1t: if (!is_dir($dirname)) { goto ZY4_D; } goto AxXjY; XQiDa: ZY4_D: goto Hb1qO; Q6za5: $this->db->rollBack(); goto HD7jc; HD7jc: return $this->error("\345\x88\x9b\xe5\273\xba\346\226\x87\xe4\273\xb6\xe5\244\271\xe5\xa4\xb1\350\264\xa5\357\xbc\201"); goto b9GbI; AyngC: $level = $this->_getLevel($id); goto Cri5g; qsJzB: $folder = $this->db->select($this->table, "\x60\156\141\155\x65\140")->where(array("\x69\144", "\x49\x4e", $level), "\101\x4e\104", array("\x74\171\160\145", "\75", "\x66\x6f\x6c\x64\145\162"))->all(); goto m0UrP; bw9Dj: qafEd: goto QXkMK; x1H9w: $level = array_filter(explode("\x2c", $level)); goto qsJzB; Vbsu4: $data = array(); goto z4zLI; nmMcl: if (!($name === null || $name === '')) { goto oPLpC; } goto XBtDb; QXkMK: } protected function postRename($request_data) { goto xlpAS; q7o_4: if (rename($oldname, $newname)) { goto FBmEQ; } goto ADzAY; He8fF: return $this->error("\xe6\227\xa0\xe6\225\210\xe7\232\204\xe5\x8f\x82\346\x95\260\357\xbc\x81"); goto ssSs3; rhc1P: $newname = $this->_UTF82GBK("\x2e\56\57" . $path . $name); goto llwKr; SQyvY: if ($is_path_update !== false) { goto duv2N; } goto icqU0; d01T0: return $this->error("\xe6\x96\207\xe4\xbb\266\351\x87\x8d\xe5\x91\275\xe5\x90\215\xe5\xa4\261\xe8\264\245\xef\xbc\x81"); goto NCSAu; l34ki: $oldname = $this->_UTF82GBK("\x2e\56\57" . $path . $finder["\156\x61\155\145"]); goto rhc1P; rQAwf: return $this->error("\xe6\x96\207\xe4\xbb\266\xe5\244\271\351\x87\x8d\xe5\221\xbd\345\x90\x8d\345\244\261\xe8\264\xa5\xef\274\x81"); goto VDPJz; HNccz: foreach ($sublist as $sub) { goto t1y3O; t1y3O: if (!($sub["\x6c\x65\x76\x65\154"] == $finder["\x6c\145\166\145\x6c"])) { goto bzYD5; } goto EKdWY; S_cFN: oJRgz: goto jKSW4; EapU8: bzYD5: goto ADRfj; ADRfj: $newpath = ''; goto JnJU_; Mji6f: J4GjA: goto bJ8j6; sCulo: if (!($is_path_update === false)) { goto WtUhU; } goto Vyj8Z; NPb4Q: foreach ($level as $lid) { goto KG_1a; Hy4I6: g3Imd: goto VNaQQ; j7710: rOx6E: goto CmgpM; CmgpM: $level_name = $levelobj["\x6e\141\x6d\x65"]; goto rSRPl; rSRPl: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto Hy4I6; bZbam: if (!($sub["\164\x79\x70\x65"] == "\146\x6f\x6c\144\x65\x72" && $sub["\154\145\x76\x65\x6c"] == $levelobj["\154\x65\166\145\x6c"])) { goto rOx6E; } goto mF4W7; KG_1a: $levelobj = $this->db->select($this->table, array("\156\x61\x6d\145", "\154\145\x76\145\x6c"))->where("\151\144\40\75\40{$lid}\x20\x41\116\104\40\x74\x79\160\145\40\x3d\x20\x27\x66\x6f\x6c\x64\145\162\47")->get(); goto bZbam; mF4W7: goto g3Imd; goto j7710; VNaQQ: } goto Mji6f; nQvH9: WtUhU: goto S_cFN; bJ8j6: $is_path_update = $this->db->update($this->table, array("\160\x61\164\x68" => $this->root . $newpath), array("\151\x64", "\75", $sub["\x69\144"]))->is(); goto sCulo; JnJU_: $level = array_filter(explode("\54", $sub["\154\x65\166\145\x6c"])); goto NPb4Q; Vyj8Z: goto iPDGz; goto nQvH9; EKdWY: goto oJRgz; goto EapU8; jKSW4: } goto i2aqu; Hwxrk: G03nv: goto hKj9Z; cxzUV: $sublist = $this->db->select($this->table, array("\151\144", "\x6c\145\166\x65\154", "\164\x79\160\x65"))->where(array("\154\145\166\145\x6c", "\114\111\113\105", "\45\54{$id}\x2c\x25"))->all(); goto HNccz; yHKJ7: glAYK: goto QwQON; lu23G: return $this->error("\346\226\207\xe4\273\xb6\xe9\207\215\345\221\xbd\xe5\x90\215\xe5\xa4\xb1\350\xb4\xa5\xef\xbc\x81"); goto XOLjd; xlpAS: $id = $request_data["\x69\x64"]; goto SHacr; dBvFv: $this->db->rollBack(); goto qOoqB; icqU0: rename($newname, $oldname); goto DfSLF; ct4wr: if (is_file($oldname)) { goto kesSc; } goto zrXAS; QwQON: goto zs3oM; goto HL0cm; Nmp_3: goto G03nv; goto OD5Aa; ZSiqa: if ($this->db->update($this->table, array("\156\141\155\x65" => $name), array("\x69\144", "\75", $id))->is()) { goto FId3d; } goto yiIn8; OD5Aa: DgSlK: goto cxzUV; vLzmb: FBmEQ: goto rvK5I; pDnQj: tXbzp: goto Hwxrk; hKj9Z: Zkct7: goto QzSNf; FDjDy: $finder = $this->db->select($this->table, array("\160\x61\x74\x68", "\x6e\x61\x6d\x65", "\x6c\x65\x76\145\154"))->where(array("\x69\144", "\x3d", $id))->get(); goto a2AtY; SHacr: $name = $request_data["\156\141\155\x65"]; goto YE7_u; E7jmW: xcnpP: goto yHKJ7; vuZwd: return $this->error("\346\x97\240\xe6\225\210\xe7\x9a\x84\xe8\xb7\257\345\276\x84\xef\xbc\x81"); goto nFDR0; rvK5I: $this->db->commit(); goto Y9zR1; jutEn: $this->db->rollBack(); goto rQAwf; ZpOr_: if ($this->db->update($this->table, array("\156\141\x6d\x65" => $name), array("\151\x64", "\x3d", $id))->is()) { goto Vs4d3; } goto jutEn; yiIn8: $this->db->rollBack(); goto lu23G; LcYVS: return $this->error("\xe6\x89\276\xe4\270\215\345\x88\xb0\xe9\x87\x8d\xe5\221\xbd\345\220\215\347\232\204\346\x96\207\344\273\xb6\x2f\346\226\207\344\273\xb6\xe5\xa4\xb9\357\xbc\x81"); goto SZpaY; VDPJz: goto Zkct7; goto LDWmm; S_zkU: if (rename($oldname, $newname)) { goto DgSlK; } goto dBvFv; PsN62: if (!(!$path || stripos($path, $this->root) === false)) { goto ZXURF; } goto vuZwd; YE7_u: if (!(!$id || $name === null || $name === '')) { goto cRjla; } goto He8fF; llwKr: $this->db->beginTransaction(); goto ct4wr; SZpaY: goto zs3oM; goto btWLr; nTTJe: return $this->error("\346\x96\x87\xe4\xbb\266\xe5\xa4\271\xe9\207\x8d\345\x91\xbd\345\220\215\345\244\261\xe8\264\xa5\xef\274\201"); goto DneOv; XOLjd: goto glAYK; goto XoQBf; QzSNf: zs3oM: goto sGZ07; a2AtY: $path = $finder["\160\141\x74\x68"]; goto PsN62; HL0cm: PYXR7: goto ZpOr_; nFDR0: ZXURF: goto l34ki; Y9zR1: return $this->success(); goto E7jmW; btWLr: kesSc: goto ZSiqa; qOoqB: return $this->error($name . "\40\346\x96\207\344\273\266\345\xa4\xb9\345\267\262\345\xad\x98\345\234\xa8\xef\xbc\201"); goto Nmp_3; XoQBf: FId3d: goto q7o_4; ioCXV: return $this->success(); goto pDnQj; DneOv: goto tXbzp; goto ANxWF; zrXAS: if (is_dir($oldname)) { goto PYXR7; } goto LcYVS; i2aqu: iPDGz: goto SQyvY; ANxWF: duv2N: goto p8DmJ; ADzAY: $this->db->rollBack(); goto d01T0; DfSLF: $this->db->rollBack(); goto nTTJe; p8DmJ: $this->db->commit(); goto ioCXV; LDWmm: Vs4d3: goto S_zkU; ssSs3: cRjla: goto FDjDy; NCSAu: goto xcnpP; goto vLzmb; sGZ07: } protected function postIsFile($request_data) { goto Cyuhx; p2n2z: hFV3m: goto jwYDk; N2qqt: $name = $request_data["\156\x61\155\x65"]; goto eQldM; eQldM: if (file_exists($this->_UTF82GBK("\x2e\x2e\57" . $path . $name))) { goto hFV3m; } goto pUMxf; jwYDk: return $this->success($name . "\40\xe6\x96\207\344\273\266\345\xb7\xb2\xe5\255\230\xe5\234\xa8\357\xbc\x81"); goto AVDnx; G4dOA: goto ym4lE; goto p2n2z; Cyuhx: $path = $request_data["\x70\141\164\x68"]; goto N2qqt; AVDnx: ym4lE: goto M3RjO; pUMxf: return $this->error($name . "\x20\346\x96\207\xe4\xbb\xb6\xe4\270\215\xe5\xad\230\xe5\234\xa8\xef\274\201"); goto G4dOA; M3RjO: } protected function postDelete($request_data) { goto ywDrM; gS8sl: foreach ($ids as $id) { goto uniW_; A4UJA: if ($file) { goto vozSU; } goto bu0k8; wxwWb: $this->db->delete($this->table, array("\154\x65\x76\145\154", "\114\111\x4b\x45", "\x25\x2c{$id}\54\x25")); goto usx3C; nbVeY: P0lhX: goto R83nl; NXlFp: if (!(!$path || stripos($path, "\144\x61\x74\x61\x2f\146\x69\x6e\144\145\162\x2f") === false || $name == null || $name == '')) { goto DlNw0; } goto Q96_z; eaSe_: SyNvY: goto nbVeY; R83nl: aNDPi: goto dDaiq; fijSw: f5UZk: goto uAt2Q; GZ7yT: x06Aa: goto OTMmS; butkC: $filename = $this->_UTF82GBK("\56\56\57" . $path . $name); goto hn1MS; OTMmS: if (!$this->db->delete($this->table, array("\x69\144", "\75", $id))->is()) { goto f5UZk; } goto pcTgO; lQfLA: V2Tv0: goto mHAcV; WgYz1: $this->_rmdir($filename); goto eaSe_; uAt2Q: goto P0lhX; goto lQfLA; PmH7f: if (is_dir($filename)) { goto V2Tv0; } goto wxwWb; Zoly5: $name = $file["\x6e\141\x6d\145"]; goto NXlFp; Wtt0w: vozSU: goto I3w8y; hn1MS: if (is_file($filename)) { goto x06Aa; } goto PmH7f; I3w8y: $path = $file["\x70\141\x74\x68"]; goto Zoly5; pcTgO: @unlink($filename); goto fijSw; bu0k8: goto aNDPi; goto Wtt0w; mdmBi: DlNw0: goto butkC; usx3C: goto P0lhX; goto GZ7yT; Q96_z: $this->db->delete($this->table, array("\151\144", "\75", $id))->is(); goto g997Q; mHAcV: if (!$this->db->delete($this->table, array("\x6c\x65\166\x65\x6c", "\114\111\x4b\105", "\45\x2c{$id}\x2c\x25"))->is()) { goto SyNvY; } goto WgYz1; g997Q: goto aNDPi; goto mdmBi; uniW_: $file = $this->db->select($this->table, array("\x70\x61\164\150", "\x6e\141\155\x65"))->where(array("\151\144", "\75", $id))->get(); goto A4UJA; dDaiq: } goto u90BE; ywDrM: $ids = $request_data["\151\x64"]; goto gS8sl; u90BE: W2eJH: goto k0BgA; k0BgA: return $this->success(); goto S1ZrP; S1ZrP: } protected function getCurPath($foid) { goto oil5g; qsc0Q: $data = $this->db->select($this->table, array("\x69\144", "\x6e\141\155\145"))->where(array(array("\151\x64", "\x49\116", $level), "\x41\116\104", array("\164\171\x70\x65", "\x3d", "\146\x6f\x6c\144\145\162")))->all(); goto qMw5y; spYf0: $level = array_filter(explode("\54", $level)); goto qsc0Q; qMw5y: return $this->success('', $data); goto JZcwW; oil5g: $level = $this->db->select($this->table, "\x6c\x65\x76\x65\x6c")->where(array("\x69\x64", "\x3d", $foid))->get(0); goto spYf0; JZcwW: } }
